{% extends "layout.html" %}
{% block title %}Chat | VoiceVibe{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
{% endblock %}

{% block content %}
<!-- Animated gradient orbs -->
<div class="gradient-orb orb-1"></div>
<div class="gradient-orb orb-2"></div>
<div class="gradient-orb orb-3"></div>

<div class="vv-shell">

  <!-- Top bar -->
  <header class="vv-topbar">
    <div class="brand">
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32" class="brand-logo">
        <circle cx="16" cy="16" r="14" fill="#007AFF" opacity="0.1"/>
        <path d="M16 6 L16 26 M6 16 L26 16" stroke="#007AFF" stroke-width="2" stroke-linecap="round"/>
        <circle cx="16" cy="16" r="2.5" fill="#007AFF"/>
      </svg>
      <div class="brand-text">
        <div class="app-name">VoiceVibe</div>
        <div class="app-sub">AI Assistant</div>
      </div>
    </div>

    <div class="top-actions">
      <button id="theme-toggle" class="theme-toggle" title="Toggle theme" aria-label="Toggle theme">ğŸŒ“</button>
      <a href="/logout" class="text-link">Logout</a>
    </div>
  </header>

  <div class="chat-layout">

    <!-- Left sidebar -->
    <aside class="vv-sidebar">
      <nav class="nav-list" role="navigation" aria-label="Main navigation">
        <button class="nav-item active" data-pane="chat" aria-label="Chat">ğŸ’¬ Chat</button>
        <button class="nav-item" data-pane="history" aria-label="History">ğŸ“š History</button>
        <button class="nav-item" data-pane="settings" aria-label="Settings">âš™ï¸ Settings</button>
      </nav>

      <div class="sidebar-footer">VoiceVibe</div>
    </aside>

    <!-- Center chat -->
    <main class="vv-main" id="main-chat-window">

      <!-- Conversation header -->
      <div class="conversation-header">
        <div class="conv-title">Conversation</div>
        <div class="conv-actions">
          <button id="export-btn" class="mini-btn" aria-label="Export conversation">Export</button>
          <button id="clear-btn" class="mini-btn" aria-label="Clear conversation">Clear</button>
        </div>
      </div>

      <!-- Messages -->
      <div id="messages" class="messages" role="log" aria-live="polite" aria-label="Chat messages"></div>

      <!-- Typing indicator -->
      <div id="typing-indicator" class="typing hidden" aria-hidden="true" aria-label="AI is typing">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
      </div>

      <!-- Waveform -->
      <div class="waveform-wrap">
        <canvas id="waveform" width="1200" height="80" aria-label="Audio waveform"></canvas>
      </div>

      <!-- Input area -->
      <div class="chat-input-area">
        <div class="input-wrapper">
          <input type="file" id="file-input" class="file-input" accept=".txt,.pdf,.doc,.docx,.mp3,.wav,.m4a,.ogg,.webm" hidden>
          <button id="file-btn" class="icon-input-btn" title="Upload file" aria-label="Upload file">ğŸ“</button>
          <button id="mic-btn" class="icon-input-btn" title="Voice input" aria-label="Voice input">ğŸ¤</button>
          <textarea id="user-input" class="chat-input" 
                    placeholder="Ask me anything..." 
                    rows="1"
                    autocomplete="off" 
                    aria-label="Message input"></textarea>
          <button id="send-btn" class="send-btn" title="Send message" aria-label="Send message">â¤</button>
        </div>
        <div id="file-preview" class="file-preview hidden"></div>
      </div>
    </main>

    <!-- Right file upload panel -->
    <aside class="upload-panel" id="upload-panel">
      <div class="upload-header">
        <div class="upload-title">Files & Uploads</div>
        <div class="upload-sub">Audio & document transcription</div>
      </div>

      <div class="upload-drop-zone" id="upload-drop-zone">
        <div class="upload-icon">ğŸ“</div>
        <div class="upload-text">Drop files here</div>
        <div class="upload-subtext">or click to browse</div>
        <div class="upload-formats">Supports: Audio (MP3, WAV, M4A) & Docs (PDF, TXT)</div>
      </div>

      <div id="upload-list" class="upload-list">
        <div class="upload-empty">No files uploaded yet</div>
      </div>

      <div class="upload-actions">
        <button id="clear-uploads-btn" class="btn-secondary">Clear All</button>
      </div>
    </aside>

    <!-- Overlays: history & settings -->
    <div id="history-pane" class="overlay-pane glass-card hidden">
      <h3>Recent Conversations</h3>
      <div id="history-list" class="history-list"></div>
    </div>

    <div id="settings-pane" class="overlay-pane glass-card hidden">
      <h3>Settings</h3>
      <form id="settings-form" class="settings-form">
        <label for="theme-select">Theme</label>
        <select id="theme-select" class="input">
          <option value="auto">Auto</option>
          <option value="dark">Dark</option>
          <option value="light">Light</option>
        </select>

        <label for="groq_key">Groq API Key</label>
        <input id="groq_key" class="input" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">

        <label for="whisper_url">Whisper URL</label>
        <input id="whisper_url" class="input" type="text" placeholder="http://localhost:...">

        <button type="submit" class="btn">Save</button>
      </form>
    </div>

  </div>

  <!-- Command Palette -->
  <div id="cmd-palette" class="cmd-palette hidden glass-card" role="dialog" aria-modal="true">
    <input id="cmd-input" class="cmd-input" placeholder="Type a command..." aria-label="Command input" />
    <div id="cmd-list" class="cmd-list"></div>
  </div>

</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
<script src="{{ url_for('static', filename='js/recorder.js') }}"></script>
<script src="{{ url_for('static', filename='js/waveform.js') }}"></script>
{% endblock %}
